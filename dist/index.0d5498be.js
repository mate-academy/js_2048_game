!function(){var t="idle",e="playing",r="lose",o=new(function(){var o;function a(e,r,o){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,a),this.board=e||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.status=t,this.isStarted=!1,this.winCallback=r,this.loseCallback=o}return o=[{key:"moveTile",value:function(t,e){var r=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=o.left-r.left,n=o.top-r.top;t.style.setProperty("--x-offset","".concat(a,"px")),t.style.setProperty("--y-offset","".concat(n,"px")),t.classList.add("moving")}},{key:"updateBoard",value:function(){for(var t=document.querySelectorAll(".field-cell"),e=0,r=0;r<this.board.length;r++)for(var o=0;o<this.board[r].length;o++){var a=t[e++],n=this.board[r][o],s=a.textContent;a.classList.remove("field-cell--".concat(s)),0===n?a.textContent="":(a.classList.add("field-cell--".concat(n)),a.textContent=n)}}},{key:"addRandomTile",value:function(){for(var t=[],e=0;e<4;e++)for(var r=0;r<4;r++)0===this.board[e][r]&&t.push({row:e,col:r});if(t.length>0){var o=t[Math.floor(Math.random()*t.length)],a=o.row,n=o.col;0===this.score&&(this.board[a][n]=2),this.updateBoard()}}},{key:"addRandomCellAfterMoving",value:function(){for(var t=[],e=0;e<4;e++)for(var r=0;r<4;r++)0===this.board[e][r]&&t.push({row:e,col:r});if(t.length>0){var o=t[Math.floor(Math.random()*t.length)],a=o.row,n=o.col;this.board[a][n]=.9>Math.random()?2:4,this.updateBoard()}}},{key:"createColumn",value:function(t){for(var e=[],r=0;r<this.board.length;r++)0!==this.board[r][t]&&e.push(this.board[r][t]);return e}},{key:"updateColumn",value:function(t,e){for(var r=!1,o=0;o<this.board.length;o++)this.board[o][t]!==e[o]&&(this.board[o][t]=e[o],r=!0);return r}},{key:"resetGameStart",value:function(){this.score=0,this.status=e,this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.addRandomTile(),this.addRandomTile()}},{key:"mergeTitles",value:function(t,e){for(var r=[],o=0;o<t.length-1;o++)t[o]===t[o+1]&&(t[o]*=2,t.splice(o+1,1),e[o]=!1,r.push(o));return r}},{key:"moveLeft",value:function(){for(var t=this,e=!1,r=0;r<this.board.length;r++)!function(r){for(var o=t.board[r].filter(function(t){return 0!==t}),a=[],n=!1,s=0;s<o.length;s++){if(n){n=!1;continue}o[s]===o[s+1]?(a.push(2*o[s]),t.getScore(!0,2*o[s]),n=!0,e=!0):a.push(o[s])}for(;a.length<t.board[r].length;)a.push(0);if(!e){for(var i=0;i<t.board[r].length;i++)if(t.board[r][i]!==a[i]){e=!0;break}}t.board[r]=a}(r);return e&&(this.addRandomCellAfterMoving(),this.updateBoard(),this.getStatus()),e}},{key:"moveRight",value:function(){for(var t=this,e=!1,r=0;r<this.board.length;r++)!function(r){for(var o=t.board[r].filter(function(t){return 0!==t}),a=[],n=!1,s=0;s<o.length;s++){if(n){n=!1;continue}o[s]===o[s+1]?(a.push(2*o[s]),t.getScore(!0,2*o[s]),n=!0,e=!0):a.push(o[s])}for(;a.length<t.board[r].length;)a.unshift(0);for(var i=0;i<t.board[r].length;i++)if(t.board[r][i]!==a[i]){e=!0;break}t.board[r]=a}(r);return e&&(this.addRandomCellAfterMoving(),this.updateBoard(),this.getStatus()),e}},{key:"moveUp",value:function(){for(var t=!1,e=0;e<this.board.length;e++){for(var r=this.createColumn(e),o=Array(r.length).fill(!0),a=0;a<r.length-1;a++)r[a]===r[a+1]&&o[a]&&o[a+1]&&(r[a]*=2,r.splice(a+1,1),t=!0,o[a]=!1,this.getScore(t,r[a]));for(;r.length<this.board.length;)r.push(0);t=this.updateColumn(e,r)||t}return t&&(this.addRandomCellAfterMoving(),this.updateBoard(),this.getStatus()),t}},{key:"moveDown",value:function(){for(var t=!1,e=0;e<this.board.length;e++){for(var r=this.createColumn(e),o=Array(r.length).fill(!0),a=r.length-1;a>0;a--)r[a]===r[a-1]&&o[a]&&o[a-1]&&(r[a]*=2,r.splice(a-1,1),t=!0,o[a]=!1,this.getScore(t,r[a]));for(;r.length<this.board.length;)r.unshift(0);t=this.updateColumn(e,r)||t}return t&&(this.addRandomCellAfterMoving(),this.updateBoard(),this.getStatus()),t}},{key:"getState",value:function(){return this.board}},{key:"getStatus",value:function(){if(0===this.score)this.status=t;else{for(var o=!1,a=!1,n=!1,s=0;s<this.board.length;s++)for(var i=0;i<this.board[s].length;i++)0===this.board[s][i]&&(o=!0),2048===this.board[s][i]&&(a=!0),s<this.board.length-1&&this.board[s][i]===this.board[s+1][i]&&(n=!0),i<this.board[s].length-1&&this.board[s][i]===this.board[s][i+1]&&(n=!0);a?(this.status="win",this.winCallback()):o||n?this.status=e:(this.status=r,this.loseCallback())}return this.status}},{key:"start",value:function(){this.resetGameStart()}},{key:"restart",value:function(){this.resetGameStart()}}],function(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}(a.prototype,o),a}())(null,function(){h.classList.remove("hidden")},function(){d.classList.remove("hidden")}),a=document.querySelector(".start"),n=document.querySelectorAll(".field-cell"),s=document.querySelector(".game-score"),i=document.querySelector(".best__score"),l=document.querySelector(".message-start"),h=document.querySelector(".message-win"),d=document.querySelector(".message-lose");function u(){d.classList.add("hidden")}function c(){h.classList.add("hidden")}function f(){var t=localStorage.getItem("highScore")||0;i.textContent=t}f(),o.getScore=function(t,e){if(t&&e>0){var r,o,a;this.score+=e,r=this.score,s.textContent=r,o=this.score,(a=localStorage.getItem("highScore"))&&!(o>a)||(localStorage.setItem("highScore",o),f())}},a.addEventListener("click",function(){a.textContent="Restart",a.classList.remove("start"),a.classList.add("restart"),s.textContent="0",n.forEach(function(t){t.classList.remove("hidden")}),("win"===o.status||o.status===r)&&(c(),u()),o.start(),l.classList.add("hidden"),u(),c(),f()}),document.addEventListener("keydown",function(t){switch(t.key){case"ArrowLeft":o.moveLeft();break;case"ArrowRight":o.moveRight();break;case"ArrowUp":o.moveUp();break;case"ArrowDown":o.moveDown()}})}();
//# sourceMappingURL=index.0d5498be.js.map
