!function(){var t={};function e(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,s=Array(e);r<e;r++)s[r]=t[r];return s}var s=new(function(){var t;function s(t){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,s),e(this,"score",0),e(this,"status","idle"),e(this,"board",[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),t&&(this.initialState=t.map(function(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return r(t,void 0);var s=Object.prototype.toString.call(t).slice(8,-1);if("Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return r(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}),this.board=t)}return t=[{key:"moveLeft",value:function(){if("idle"!==this.status){var t=[],e=this.score,r=!0,s=!1,i=void 0;try{for(var n,a=this.board[Symbol.iterator]();!(r=(n=a.next()).done);r=!0){for(var o=n.value.filter(function(t){return 0!==t}),l=1;l<o.length;l++)if(o[l]===o[l-1]){var h=o[l]+o[l-1];this.score+=h,o.splice(l-1,2,h)}for(;o.length<4;)o.push(0);t.push(o)}}catch(t){s=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(s)throw i}}if(!0!==this.deepEqualBoards(t,this.board)){if(this.board=t,this.checkWin()&&(this.status="win"),e===this.score&&0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()){this.status="lose";return}this.setRandomNumberOnCell(),0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()&&(this.status="lose")}}}},{key:"moveRight",value:function(){if("idle"!==this.status){var t=[],e=this.score,r=!0,s=!1,i=void 0;try{for(var n,a=this.board[Symbol.iterator]();!(r=(n=a.next()).done);r=!0){for(var o=n.value.filter(function(t){return 0!==t}),l=o.length-2;l>=0;l--)if(o[l]===o[l+1]){var h=o[l]+o[l+1];this.score+=h,o.splice(l,2,h),l--}for(;o.length<4;)o.unshift(0);t.push(o)}}catch(t){s=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(s)throw i}}if(!0!==this.deepEqualBoards(t,this.board)){if(this.board=t,this.checkWin()&&(this.status="win"),e===this.score&&0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()){this.status="lose";return}this.setRandomNumberOnCell(),0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()&&(this.status="lose")}}}},{key:"moveUp",value:function(){if("idle"!==this.status){for(var t=this.score,e=Array.from({length:4},function(){return[]}),r=Array.from({length:4},function(){return[]}),s=[],i=0;i<4;i++)for(var n=0;n<4;n++)e[i].push(this.board[n][i]);var a=!0,o=!1,l=void 0;try{for(var h,u=e[Symbol.iterator]();!(a=(h=u.next()).done);a=!0){for(var c=h.value.filter(function(t){return 0!==t}),f=1;f<c.length;f++)if(c[f]===c[f-1]){var d=c[f]+c[f-1];this.score+=d,c.splice(f-1,2,d)}for(;c.length<4;)c.push(0);s.push(c)}}catch(t){o=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(o)throw l}}for(var v=0;v<4;v++)for(var y=0;y<4;y++)r[v].push(s[y][v]);if(!0!==this.deepEqualBoards(r,this.board)){if(this.board=r,this.checkWin()&&(this.status="win"),t===this.score&&0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()){this.status="lose";return}this.setRandomNumberOnCell(),0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()&&(this.status="lose")}}}},{key:"moveDown",value:function(){if("idle"!==this.status){for(var t=this.score,e=Array.from({length:4},function(){return[]}),r=Array.from({length:4},function(){return[]}),s=[],i=0;i<4;i++)for(var n=0;n<4;n++)e[i].push(this.board[n][i]);var a=!0,o=!1,l=void 0;try{for(var h,u=e[Symbol.iterator]();!(a=(h=u.next()).done);a=!0){for(var c=h.value.filter(function(t){return 0!==t}),f=c.length-2;f>=0;f--)if(c[f]===c[f+1]){var d=c[f]+c[f+1];this.score+=d,c.splice(f,2,d),f--}for(;c.length<4;)c.unshift(0);s.push(c)}}catch(t){o=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(o)throw l}}for(var v=0;v<4;v++)for(var y=0;y<4;y++)r[v].push(s[y][v]);if(!0!==this.deepEqualBoards(r,this.board)){if(this.board=r,this.checkWin()&&(this.status="win"),t===this.score&&0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()){this.status="lose";return}this.setRandomNumberOnCell(),0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()&&(this.status="lose")}}}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.board}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){"playing"!==this.status?(this.setRandomNumberOnCell(),this.status="playing"):(this.board=this.initialState||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.setRandomNumberOnCell(),this.setRandomNumberOnCell())}},{key:"restart",value:function(){if(this.score=0,this.board=this.initialState||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.initialState){this.status="idle";return}this.status="idle",this.setRandomNumberOnCell(),this.status="playing"}},{key:"setRandomNumberOnCell",value:function(){var t=this.getEmptyCells();if("idle"===this.status&&t.length>=2){var e,r=Math.floor(Math.random()*t.length);do e=Math.floor(Math.random()*t.length);while(r===e)this.board[t[r].row][t[r].col]=.1>=Math.random()?4:2,this.board[t[e].row][t[e].col]=.1>=Math.random()?4:2}else if(t.length>=1){var s=Math.floor(Math.random()*t.length);this.board[t[s].row][t[s].col]=.1>=Math.random()?4:2}}},{key:"getEmptyCells",value:function(){for(var t=[],e=0;e<4;e++)for(var r=0;r<4;r++)0===this.board[e][r]&&t.push({row:e,col:r});return t}},{key:"checkAvailableMoves",value:function(){for(var t=!1,e=0;e<4;e++)for(var r=0;r<4;r++)r<3&&this.board[e][r]===this.board[e][r+1]&&(t=!0),e<3&&this.board[e][r]===this.board[e+1][r]&&(t=!0);return t}},{key:"checkWin",value:function(){for(var t=!1,e=0;e<4;e++)for(var r=0;r<4;r++)2048===this.board[e][r]&&(t=!0,this.status="win");return t}},{key:"deepEqualBoards",value:function(t,e){return t.every(function(t,r){return t.every(function(t,s){return t===e[r][s]})})}}],function(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}(s.prototype,t),s}()),i=document.querySelector(".message-start"),n=document.querySelector(".message-win"),a=document.querySelector(".message-lose"),o=document.querySelector(".start"),l=document.querySelectorAll(".field-row"),h=document.querySelector(".game-score");o.addEventListener("click",function(){o.classList.contains("restart")?(a.classList.add("hidden"),n.classList.add("hidden"),s.restart(),y(),h.textContent=0):(i.classList.add("hidden"),s.start(),y())}),document.addEventListener("keydown",v);var u=0,c=0,f=0,d=0;function v(t){if("lose"!==s.status&&i.classList.contains("hidden")){switch(o.setAttribute("class","button restart"),o.textContent="Restart",t.key){case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown()}h.textContent=s.score,s.checkWin(),"win"===s.status?n.classList.remove("hidden"):"lose"===s.status&&a.classList.remove("hidden"),y()}}function y(){for(var t=s.getState(),e=0;e<4;e++)for(var r=0;r<4;r++)t[e][r]?(l[e].children[r].textContent=t[e][r],l[e].children[r].setAttribute("class","field-cell field-cell--".concat(t[e][r]))):(l[e].children[r].textContent="",l[e].children[r].setAttribute("class","field-cell field-cell--empty"))}document.addEventListener("touchstart",function(t){u=t.touches[0].clientX,c=t.touches[0].clientY}),document.addEventListener("touchmove",function(t){t.preventDefault()},{passive:!1}),document.addEventListener("touchend",function(t){var e,r;f=t.changedTouches[0].clientX,d=t.changedTouches[0].clientY,Math.abs(e=f-u)>Math.abs(r=d-c)?e>50?v({key:"ArrowRight"}):e<-50&&v({key:"ArrowLeft"}):r>50?v({key:"ArrowDown"}):r<-50&&v({key:"ArrowUp"})})}();
//# sourceMappingURL=index.8d0ce20a.js.map
