const t="idle",e="playing",s="lose",o=new class{constructor(e,s,o){this.board=e||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.status=t,this.isStarted=!1,this.winCallback=s,this.loseCallback=o}moveTile(t,e){let s=t.getBoundingClientRect(),o=e.getBoundingClientRect(),r=o.left-s.left,l=o.top-s.top;t.style.setProperty("--x-offset",`${r}px`),t.style.setProperty("--y-offset",`${l}px`),t.classList.add("moving")}updateBoard(){let t=document.querySelectorAll(".field-cell"),e=0;for(let s=0;s<this.board.length;s++)for(let o=0;o<this.board[s].length;o++){let r=t[e++],l=this.board[s][o],a=r.textContent;r.classList.remove(`field-cell--${a}`),0===l?r.textContent="":(r.classList.add(`field-cell--${l}`),r.textContent=l)}}addRandomTile(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.board[e][s]&&t.push({row:e,col:s});if(t.length>0){let{row:e,col:s}=t[Math.floor(Math.random()*t.length)];0===this.score&&(this.board[e][s]=2),this.updateBoard()}}addRandomCellAfterMoving(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.board[e][s]&&t.push({row:e,col:s});if(t.length>0){let{row:e,col:s}=t[Math.floor(Math.random()*t.length)];this.board[e][s]=.9>Math.random()?2:4,this.updateBoard()}}createColumn(t){let e=[];for(let s=0;s<this.board.length;s++)0!==this.board[s][t]&&e.push(this.board[s][t]);return e}updateColumn(t,e){let s=!1;for(let o=0;o<this.board.length;o++)this.board[o][t]!==e[o]&&(this.board[o][t]=e[o],s=!0);return s}resetGameStart(){this.score=0,this.status=e,this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.addRandomTile(),this.addRandomTile()}mergeTitles(t,e){let s=[];for(let o=0;o<t.length-1;o++)t[o]===t[o+1]&&(t[o]*=2,t.splice(o+1,1),e[o]=!1,s.push(o));return s}moveLeft(){let t=!1;for(let e=0;e<this.board.length;e++){let s=this.board[e].filter(t=>0!==t),o=[],r=!1;for(let e=0;e<s.length;e++){if(r){r=!1;continue}s[e]===s[e+1]?(o.push(2*s[e]),this.getScore(!0,2*s[e]),r=!0,t=!0):o.push(s[e])}for(;o.length<this.board[e].length;)o.push(0);if(!t){for(let s=0;s<this.board[e].length;s++)if(this.board[e][s]!==o[s]){t=!0;break}}this.board[e]=o}return t&&(this.addRandomCellAfterMoving(),this.updateBoard(),this.getStatus()),t}moveRight(){let t=!1;for(let e=0;e<this.board.length;e++){let s=this.board[e].filter(t=>0!==t),o=[],r=!1;for(let e=0;e<s.length;e++){if(r){r=!1;continue}s[e]===s[e+1]?(o.push(2*s[e]),this.getScore(!0,2*s[e]),r=!0,t=!0):o.push(s[e])}for(;o.length<this.board[e].length;)o.unshift(0);for(let s=0;s<this.board[e].length;s++)if(this.board[e][s]!==o[s]){t=!0;break}this.board[e]=o}return t&&(this.addRandomCellAfterMoving(),this.updateBoard(),this.getStatus()),t}moveUp(){let t=!1;for(let e=0;e<this.board.length;e++){let s=this.createColumn(e),o=Array(s.length).fill(!0);for(let e=0;e<s.length-1;e++)s[e]===s[e+1]&&o[e]&&o[e+1]&&(s[e]*=2,s.splice(e+1,1),t=!0,o[e]=!1,this.getScore(t,s[e]));for(;s.length<this.board.length;)s.push(0);t=this.updateColumn(e,s)||t}return t&&(this.addRandomCellAfterMoving(),this.updateBoard(),this.getStatus()),t}moveDown(){let t=!1;for(let e=0;e<this.board.length;e++){let s=this.createColumn(e),o=Array(s.length).fill(!0);for(let e=s.length-1;e>0;e--)s[e]===s[e-1]&&o[e]&&o[e-1]&&(s[e]*=2,s.splice(e-1,1),t=!0,o[e]=!1,this.getScore(t,s[e]));for(;s.length<this.board.length;)s.unshift(0);t=this.updateColumn(e,s)||t}return t&&(this.addRandomCellAfterMoving(),this.updateBoard(),this.getStatus()),t}getState(){return this.board}getStatus(){if(0===this.score)this.status=t;else{let t=!1,o=!1,r=!1;for(let e=0;e<this.board.length;e++)for(let s=0;s<this.board[e].length;s++)0===this.board[e][s]&&(t=!0),2048===this.board[e][s]&&(o=!0),e<this.board.length-1&&this.board[e][s]===this.board[e+1][s]&&(r=!0),s<this.board[e].length-1&&this.board[e][s]===this.board[e][s+1]&&(r=!0);o?(this.status="win",this.winCallback()):t||r?this.status=e:(this.status=s,this.loseCallback())}return this.status}start(){this.resetGameStart()}restart(){this.resetGameStart()}}(null,function(){h.classList.remove("hidden"),h.classList.add("message-win"),h.textContent="You Win!"},function(){h.classList.remove("hidden"),h.classList.add("message-lose"),h.textContent="You Lose!"}),r=document.querySelector(".start"),l=document.querySelectorAll(".field-cell"),a=document.querySelector(".game-score"),i=document.querySelector(".best__score"),h=document.querySelector(".message-container");function n(){h.classList.add("hidden")}function d(){let t=localStorage.getItem("highScore")||0;i.textContent=t}d(),o.getScore=function(t,e){if(t&&e>0){var s;this.score+=e,s=this.score,a.textContent=s,function(t){let e=localStorage.getItem("highScore");(!e||t>e)&&(localStorage.setItem("highScore",t),d())}(this.score)}},r.addEventListener("click",()=>{r.textContent="Restart",r.classList.remove("start"),r.classList.add("restart"),a.textContent="0",l.forEach(t=>{t.classList.remove("hidden")}),("win"===o.status||o.status===s)&&n(),o.start(),n(),d()}),document.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":o.moveLeft();break;case"ArrowRight":o.moveRight();break;case"ArrowUp":o.moveUp();break;case"ArrowDown":o.moveDown()}});
//# sourceMappingURL=index.edb5a6b7.js.map
