var t={};class e{static GameStatus={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.state=JSON.parse(JSON.stringify(t)),this.initialState=JSON.parse(JSON.stringify(t)),this.status=e.GameStatus.idle,this.score=0}moveLeft(){if("playing"===this.getStatus()){let t=[...this.state];for(let e=0;e<this.state.length;e++)t[e]=this.move(t[e]);this.canMerge(t)&&(this.state=[...t],this.isWin(),this.generateGameNumber()),this.isLose(t)}}moveRight(){if("playing"===this.getStatus()){let t=[...this.state];for(let e=0;e<this.state.length;e++){let s=[...t[e]];s.reverse(),(s=this.move(s)).reverse(),t[e]=s}this.canMerge(t)&&(this.state=[...t],this.isWin(),this.generateGameNumber()),this.isLose(t)}}moveUp(){if("playing"===this.getStatus()){let t=[void 0,void 0,void 0,void 0].map(()=>[,,,,].fill(0));for(let e=0;e<this.state.length;e++){let s=[this.state[0][e],this.state[1][e],this.state[2][e],this.state[3][e]];s=this.move(s);for(let i=0;i<this.state.length;i++)t[i][e]=s[i]}this.canMerge(t)&&(this.state=[...t],this.isWin(),this.generateGameNumber()),this.isLose(t)}}moveDown(){if("playing"===this.getStatus()){let t=[void 0,void 0,void 0,void 0].map(()=>[,,,,].fill(0));for(let e=0;e<this.state.length;e++){let s=[this.state[0][e],this.state[1][e],this.state[2][e],this.state[3][e]].reverse();s=(s=this.move(s)).reverse();for(let i=0;i<this.state.length;i++)t[i][e]=s[i]}this.canMerge(t)&&(this.state=[...t],this.isWin(),this.generateGameNumber()),this.isLose(t)}}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=e.GameStatus.playing,this.generateGameNumber(),this.generateGameNumber()}restart(){this.state=JSON.parse(JSON.stringify(this.initialState)),this.status=e.GameStatus.idle,this.score=0}move(t){let e=t.filter(t=>0!==t);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,this.score+=e[t]);let s=e.filter(t=>0!==t);for(;s.length<4;)s.push(0);return s}isWin(){for(let t=0;t<this.state.length;t++)for(let s=0;s<this.state[t].length;s++)if(2048===this.state[t][s]){this.status=e.GameStatus.win;return}}canMerge(t){return JSON.stringify(t)!==JSON.stringify(this.state)}canMove(){let t=this.state.length;for(let e=0;e<t;e++)for(let s=0;s<t;s++)if(s<t-1&&this.state[e][s]===this.state[e][s+1]||e<t-1&&this.state[e][s]===this.state[e+1][s])return!0;return!1}emptyCellsCount(){let t=[];for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[e].length;s++)0===this.state[e][s]&&t.push([e,s]);return t}generateGameNumber(){let t=this.emptyCellsCount();if(0!==t.length){let e=Math.floor(Math.random()*t.length),s=t[e][1],i=t[e][0];this.state[i][s]=Math.random()>=.9?4:2}}isLose(){0!==this.emptyCellsCount().length||this.canMove()||(this.status=e.GameStatus.lose)}}const s=new(t=e),i=document.querySelector(".button.start"),a=document.querySelector(".message-start"),r=document.querySelector(".game-score"),n=document.querySelector(".message-win"),h=document.querySelector(".message-lose");function l(){let t=[...document.querySelectorAll(".field-row")].map(t=>[...t.children]);s.getState().forEach((e,s)=>{e.forEach((e,i)=>{let a=t[s][i];a.className=e?`field-cell field-cell--${e}`:"field-cell",a.innerHTML=e||""})})}i.addEventListener("click",()=>{"Start"===i.textContent?(i.textContent="Restart",i.classList.replace("start","restart"),a.classList.add("hidden"),s.start(),l()):"Restart"===i.textContent&&(i.textContent="Start",i.classList.replace("restart","start"),a.classList.remove("hidden"),n.classList.add("hidden"),h.classList.add("hidden"),s.restart(),l(),r.textContent=s.getScore())}),document.addEventListener("keydown",e=>{"playing"===s.getStatus()&&("ArrowUp"===e.key&&s.moveUp(),"ArrowDown"===e.key&&s.moveDown(),"ArrowLeft"===e.key&&s.moveLeft(),"ArrowRight"===e.key&&s.moveRight()),s.getStatus()===t.GameStatus.lose&&h.classList.remove("hidden"),s.getStatus()===t.GameStatus.win&&n.classList.remove("hidden"),l(),r.textContent=s.getScore()});
//# sourceMappingURL=index.7796d93b.js.map
