var t={};const e=new class{score=0;status="idle";board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];constructor(t){t&&(this.initialState=t.map(t=>[...t]),this.board=t)}moveLeft(){if("idle"===this.status)return;let t=[],e=this.score;for(let e of this.board){let s=e.filter(t=>0!==t);for(let t=1;t<s.length;t++)if(s[t]===s[t-1]){let e=s[t]+s[t-1];this.score+=e,s.splice(t-1,2,e)}for(;s.length<4;)s.push(0);t.push(s)}if(!0!==this.deepEqualBoards(t,this.board)){if(this.board=t,this.checkWin()&&(this.status="win"),e===this.score&&0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()){this.status="lose";return}this.setRandomNumberOnCell(),0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()&&(this.status="lose")}}moveRight(){if("idle"===this.status)return;let t=[],e=this.score;for(let e of this.board){let s=e.filter(t=>0!==t);for(let t=s.length-2;t>=0;t--)if(s[t]===s[t+1]){let e=s[t]+s[t+1];this.score+=e,s.splice(t,2,e),t--}for(;s.length<4;)s.unshift(0);t.push(s)}if(!0!==this.deepEqualBoards(t,this.board)){if(this.board=t,this.checkWin()&&(this.status="win"),e===this.score&&0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()){this.status="lose";return}this.setRandomNumberOnCell(),0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()&&(this.status="lose")}}moveUp(){if("idle"===this.status)return;let t=this.score,e=Array.from({length:4},()=>[]),s=Array.from({length:4},()=>[]),i=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)e[t].push(this.board[s][t]);for(let t of e){let e=t.filter(t=>0!==t);for(let t=1;t<e.length;t++)if(e[t]===e[t-1]){let s=e[t]+e[t-1];this.score+=s,e.splice(t-1,2,s)}for(;e.length<4;)e.push(0);i.push(e)}for(let t=0;t<4;t++)for(let e=0;e<4;e++)s[t].push(i[e][t]);if(!0!==this.deepEqualBoards(s,this.board)){if(this.board=s,this.checkWin()&&(this.status="win"),t===this.score&&0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()){this.status="lose";return}this.setRandomNumberOnCell(),0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()&&(this.status="lose")}}moveDown(){if("idle"===this.status)return;let t=this.score,e=Array.from({length:4},()=>[]),s=Array.from({length:4},()=>[]),i=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)e[t].push(this.board[s][t]);for(let t of e){let e=t.filter(t=>0!==t);for(let t=e.length-2;t>=0;t--)if(e[t]===e[t+1]){let s=e[t]+e[t+1];this.score+=s,e.splice(t,2,s),t--}for(;e.length<4;)e.unshift(0);i.push(e)}for(let t=0;t<4;t++)for(let e=0;e<4;e++)s[t].push(i[e][t]);if(!0!==this.deepEqualBoards(s,this.board)){if(this.board=s,this.checkWin()&&(this.status="win"),t===this.score&&0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()){this.status="lose";return}this.setRandomNumberOnCell(),0===this.getEmptyCells().length&&!1===this.checkAvailableMoves()&&(this.status="lose")}}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}start(){"playing"!==this.status?(this.setRandomNumberOnCell(),this.status="playing"):(this.board=this.initialState||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.setRandomNumberOnCell(),this.setRandomNumberOnCell())}restart(){if(this.score=0,this.board=this.initialState||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.initialState){this.status="idle";return}this.status="idle",this.setRandomNumberOnCell(),this.status="playing"}setRandomNumberOnCell(){let t=this.getEmptyCells();if("idle"===this.status&&t.length>=2){let e;let s=Math.floor(Math.random()*t.length);do e=Math.floor(Math.random()*t.length);while(s===e)this.board[t[s].row][t[s].col]=.1>=Math.random()?4:2,this.board[t[e].row][t[e].col]=.1>=Math.random()?4:2}else if(t.length>=1){let e=Math.floor(Math.random()*t.length);this.board[t[e].row][t[e].col]=.1>=Math.random()?4:2}}getEmptyCells(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.board[e][s]&&t.push({row:e,col:s});return t}checkAvailableMoves(){let t=!1;for(let e=0;e<4;e++)for(let s=0;s<4;s++)s<3&&this.board[e][s]===this.board[e][s+1]&&(t=!0),e<3&&this.board[e][s]===this.board[e+1][s]&&(t=!0);return t}checkWin(){let t=!1;for(let e=0;e<4;e++)for(let s=0;s<4;s++)2048===this.board[e][s]&&(t=!0,this.status="win");return t}deepEqualBoards(t,e){return t.every((t,s)=>t.every((t,i)=>t===e[s][i]))}},s=document.querySelector(".message-start"),i=document.querySelector(".message-win"),l=document.querySelector(".message-lose"),r=document.querySelector(".start"),o=document.querySelectorAll(".field-row"),h=document.querySelector(".game-score");r.addEventListener("click",()=>{r.classList.contains("restart")?(l.classList.add("hidden"),i.classList.add("hidden"),e.restart(),f(),h.textContent=0):(s.classList.add("hidden"),e.start(),f())}),document.addEventListener("keydown",u);let a=0,n=0,c=0,d=0;function u(t){if("lose"!==e.status&&s.classList.contains("hidden")){switch(r.setAttribute("class","button restart"),r.textContent="Restart",t.key){case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown()}h.textContent=e.score,e.checkWin(),"win"===e.status?i.classList.remove("hidden"):"lose"===e.status&&l.classList.remove("hidden"),f()}}function f(){let t=e.getState();for(let e=0;e<4;e++)for(let s=0;s<4;s++)t[e][s]?(o[e].children[s].textContent=t[e][s],o[e].children[s].setAttribute("class",`field-cell field-cell--${t[e][s]}`)):(o[e].children[s].textContent="",o[e].children[s].setAttribute("class","field-cell field-cell--empty"))}document.addEventListener("touchstart",t=>{a=t.touches[0].clientX,n=t.touches[0].clientY}),document.addEventListener("touchmove",t=>{t.preventDefault()},{passive:!1}),document.addEventListener("touchend",t=>{c=t.changedTouches[0].clientX,d=t.changedTouches[0].clientY,function(){let t=c-a,e=d-n;Math.abs(t)>Math.abs(e)?t>50?u({key:"ArrowRight"}):t<-50&&u({key:"ArrowLeft"}):e>50?u({key:"ArrowDown"}):e<-50&&u({key:"ArrowUp"})}()});
//# sourceMappingURL=index.0cd8c2a4.js.map
